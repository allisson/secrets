# ðŸš€ Secrets v0.4.0 Release Notes

> Release date: 2026-02-18

This release adds tokenization capabilities for format-preserving data protection,
including API endpoints, CLI operations, persistence, and observability.

## Highlights

- Added tokenization API under `/v1/tokenization/*`
- Added tokenization key lifecycle: create, rotate, delete
- Added token lifecycle: tokenize, detokenize, validate, revoke
- Added deterministic mode support for repeatable token generation
- Added token format support: `uuid`, `numeric`, `luhn-preserving`, `alphanumeric`
- Added expired-token maintenance command: `clean-expired-tokens`

## API Additions

New endpoints:

- `POST /v1/tokenization/keys`
- `POST /v1/tokenization/keys/{name}/rotate`
- `DELETE /v1/tokenization/keys/{id}`
- `POST /v1/tokenization/keys/{name}/tokenize`
- `POST /v1/tokenization/detokenize`
- `POST /v1/tokenization/validate`
- `POST /v1/tokenization/revoke`

## CLI Additions

- `create-tokenization-key --name <name> --format <fmt> [--deterministic] [--algorithm <alg>]`
- `rotate-tokenization-key --name <name> --format <fmt> [--deterministic] [--algorithm <alg>]`
- `clean-expired-tokens --days <n> [--dry-run] [--format text|json]`

## Data Model and Migrations

Added migration `000002_add_tokenization` for PostgreSQL and MySQL:

- `tokenization_keys` table for versioned key metadata
- `tokenization_tokens` table for token-to-ciphertext mapping and lifecycle fields

## Observability

Added tokenization business operations metrics in the `tokenization` domain,
including key and token lifecycle operations.

## Runtime and Compatibility

- API baseline remains v1 (`/v1/*`)
- Local development targets: Linux and macOS
- CI baseline: Go `1.25.5`, PostgreSQL `16-alpine`, MySQL `8.0`
- Compatibility targets: PostgreSQL `12+`, MySQL `8.0+`

## Upgrade Notes

- Non-breaking addition: tokenization capability under API v1
- Existing auth, secrets, transit, and audit behavior remain compatible
- Run database migrations before using tokenization endpoints or CLI commands

## Upgrade Checklist

1. Deploy binaries/images with `v0.4.0`
2. Run DB migrations (`app migrate`) before serving traffic
3. Verify baseline health (`GET /health`, `GET /ready`)
4. Create a tokenization key (`create-tokenization-key` or `POST /v1/tokenization/keys`)
5. Run round-trip check: tokenize -> detokenize -> validate -> revoke
6. Schedule retention cleanup for expired tokens (`clean-expired-tokens`)

## Rollback Notes

- `000002_add_tokenization` is additive schema migration and is expected to remain applied during app rollback.
- Rolling back binaries/images to pre-`v0.4.0` can leave tokenization tables unused but present.
- Avoid destructive schema rollback in production unless you have a validated backup/restore plan.
- If rollback is required, keep existing data and disable tokenization traffic paths operationally until re-upgrade.

## See also

- [Tokenization API](../api/tokenization.md)
- [CLI commands reference](../cli/commands.md)
- [Production operations](../operations/production.md)
- [API compatibility policy](../api/versioning-policy.md)
